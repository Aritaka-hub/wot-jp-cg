# 第３回　WoT-JP CGイベント - W3C Web of Things & ECHONET Lite Web API 勉強会　議事録（案）

* 開催日
    * 2022年03月11日(金) 17時00分〜19時00分(JST)
* 座長
    * 安次富 
* 登壇者
    * 水嶌, 芦村, 東村, 浅井, 安次富, 寺本（エコーネットコンソーシアム）
* 参加者：　36名
* https://wot-jp-cg.connpass.com/event/239394/participation/#participants
* 注意事項
  * 議事録はhackmdを使用します。
  * 議事録の内容について、特に発言者は各自確認をしてください。
  * 議事録はまとめたものを後で WoT-JP CG の Github 上で公開します。
  * 質問は Zoom のチャットに書いてください。順番に司会の方から指名させていただきます。議事録の方は質問が終わり次第、hackmd からは削除します。
  * 質問そのものは、最後の方に Q&A の時間を用意していますので、そこでまとめて対応する予定です。
  
## Agenda
1. 勉強会の趣旨説明（安次富）
* WoT＆ELWAの最新情報についての勉強会を行う
* WoT のインプリを含めた内容を説明する
* ELWA という標準規格の策定しているが、WoT との関係を含めて解説をしていただく

-----
2. 開会ご挨拶 / WoT-JP CG の紹介（水嶌）
    * [CG設立の趣旨](https://github.com/w3c/wot-jp-cg/blob/main/Event/20220311_3rd_WoT_and_ELWA_Study_Meeting/20220311-WoT-JP_CG_Mizushima.pdf)
* IoTサイロの問題が出てきていることから、W3Cでその解決に向けて取り組んでいるのが WoT となる
* WoT の期待として、様々なインフラに活用される事が期待されている
* 2020年にW3Cより勧告はされているが、まだまだ新しい規格
* 日本の認知度を上げる必要があることから WoT-JP CG を作成した
* CG には4つの TF があり活動を行っている
* ELWAとWoTの共存を考える機会として勉強会を設けた
* デプロイメントの解説を行うため企画した
* GitHub において質問を受け付けている、興味を持った方はCGに参加もしてほしい

-----
3. WoT セッション1:WoT 仕様と標準化の最新動向（芦村）
    * [WoTの現状とビジョン](https://github.com/w3c/wot-jp-cg/blob/main/Event/20220311_3rd_WoT_and_ELWA_Study_Meeting/20220311-WoT-JP_CG_Ashimura.pdf)
* Web技術はさまざまに活用されており、様々なものがつながっている
* W3Cは国際的な標準化団体である
* 標準化作業とはドキュメントの作りこみ作業となる
* WG, IG, BG, CG があり、様々な活動をしている
* 様々なプラットフォームがある中で統合化は難しい
* 解消する手段として WoT がある、肝の技術は TD と言われるものがある
* PlugFest で様々な企業が参加し試験している
* ELWA にも PlugFest に参加していただいた
* ドキュメントの進行状況について、バージョンアップして公開されている
* マルチベンダが相互連携したユースケースも公開されている
* 垂直/水平 展開でユースケースが集まってきている
* ...
* バージョンアップしていくのと共にユースケースを集めていく
* 何故今標準化作業をしているのかという話
* 標準化はこれまで 10 年くらい参加していって下積みをしてやっと本格的に出来る
* 英語が出来る人、ネゴが出来る人などの能力を持った人が数年かけてやっとできる
* 1人でやるのは大変なのでノウハウがある人を数名集めて対応していくという役割分担も必要

-----
4. WoT セッション2:WoT の仕様と実装 - WoT の作り方/使い方（東村／浅井）
    * [発表ノート](https://github.com/k-toumura/document-for-wot/raw/master/20220311_WoT-ELWA.pdf)
    * [WoT-JP CGポータルサイト](https://wot-jp-cg.netlify.app/#/raspithing)
* 概念モデルがアーキテクチャ
* WoTデバイスの記述方式が Thing Description
* プロトコル記述が Protocol Binding
* Profile は TD とデバイスをつなげる部分
* Discovery
* これらがまとまって基本構成が作られている
* arch では最小限のモデルを定義している
    * thing と consumer がどのようにインタラクションをするのかを Thing Description というモノで書く
    * そこに書かれたものを使って consumer 側/IoT アプリ側 が使うのが consume という処理
* Thing では Property、Action、Event の3つのパターンでモデル化されている
* Thing Description は JSON-LD で記述されている、ほかの標準化と連携が可能となっている
* TD を介して相互連携をさせるようにしている
* WoT-JP CG のサイトにチュートリアルで RasPi を使った作成例が掲載されている
    * チュートリアルでは Node-RED を使用した例が書かれている
    * これまで作られた IoT 機器に TD を書いていくことになる
    * 実装支援ツールとして、Node-wot、Node Generator などがある
        * Node Generator のデモを実演
* 日本語のドキュメントがそろってき始めているので、WoT を体験しやすくなってきた
* TD を書けばよく様々な方法があるが、様々な機器で使えるものを紹介する
    * 温湿度センサーの実装例の紹介
    * Hue 電球ホワイトグラデーションの実装例の紹介
    * SwitchBot 開閉センサーの実装例の紹介
    * ロボットアーム myCobot 280 の実装例の紹介
    * 複数の IoT機器の Node-RED ダッシュボード連携の様子の紹介
* WoT の支援ツールは様々な物が出来つつある、情報は W3C IG の管理ページに掲載されている
* 日本語ドキュメントとして、WoT-JP CG ポータルサイトと GitHub が用意されている
* 質疑応答
なし

-----
5. ELWA セッション:ECHONET Lite Web APIの紹介（寺本）
* 標準化までの時間の都合などの制約から WoT をそのまま採用とはならなかったが、非常に近く親和性がアリ、相互連携のし易い仕様となっています
* 発表の流れ全体を確認
* まず ECHONET Lite についての紹介
* 今回の参加者には知っている人も多いでしょうが改めて説明。住宅設備機器やエネルギー設備などの監視制御する国際通信規格
* Lite というのはもともと ECHONET の企画を簡易化したもの
* 2012年に経産省より標準インターフェースとして認定を受けた
* 100 周囲以上の様々な業界ベンダーの専門家からの意見を受けて標準化してきた
* 仕様の全体像。国際標準を取得した部分がどうなっているかの図を見せて説明
    * WiFi などは既存のモノを利用する
    * 既存仕様では伝送媒体と上位がリンクしているものもあるが EL では伝送媒体異存がない
    * IPv4/6 UDP ベース、TCP  対応も可能で自由に
    * 第三者認証による相互接続性確保も出来る、アプリレベルでの相互認証をしている
* 各業界団体と仕様を進めており 2012 年に始めた HEMS 重点 8 に加え、現在 ZEH+ などの補助金要件にもなる仕様
* VPP 実証などでも利用されている
* 対応製品は累計 1 億台を突破、今年も更に 1 千万以上の機器が出荷されている
* エアコンなどはほぼ全てが対応している、蓄電池や給湯器も対応割合が高い。
* スマートメーターが一番多いが、国内全家庭に再来年程度までに入る
* コンソーシアム体制の説明。
* ECHONET Lite Web API とは
    * 宅内にある機器をクラウドを介して外部アプリから操作するための統一インターフェイス
    * 宅内は ECHONetLite 機器を想定しているが他のモノも対応出来る
    * 本WebAPI は外部向けに露出している部分の説明になることに注意
* 仕様書は館員以外もコンソーシアムサイトから閲覧できる https://echonet.jp/web_api/
* 教育機関の認定制度も開始されている、「ECHONET IoT マスター制度」で認定を受けていただく認定制度も開始している
* 実際に対応サービスの展開開始しており、インターネット側のクラウドに採用しているモノ以外に、ゲートウェイなどの色々な所での採用がされている
* 電力、見守り、そのたいろいろなサービス毎ではなく統一の API を提供しているため連携が容易になる
* あるいは各クラウドが同じ ELWA 対応すると集約クラウドというのも作りやすくなる
* 宅内の多様な機器を繋ぎ、多少な業種を繋げ、異業種での連携が可能な IoT プラットフォームを実現
* 次に技術面の特徴
* EL は バイナリ形式のデータ、命令で表現される仕様これにたいし ELWA は JSON の人間が可読なデータ形式
* 例えば機器オブジェクトも 0x0130** + IP addr + portN などではなく homeAirConditionaer + device ID となるなど、文字列・可読なIDとラベルで記述する
* 風量レベルなどの数値データのマッピングは比較的単純に 1:1 対応するような形
* ECHONET の API は Get,SetC などとあるのを HTTP GET, PUT などに対応付けるなど、Web REST API への対応付けをしている
* Web でのリソースを表す URL はホスト名固定、サービス種ごとにパスを決めるなどして分かり易くしている
    * リソース指定も /devices は機器集合
    * /devices/|<deviceid|> とすれば機器情報
    * /devices/|<deviceid|>/property で記事のプロパティ...などというストレートな URL パスのような構成で API 設計がされている
* ガイドラインについて
* API 仕様部 + 機器仕様部 の 2 部構成
* API 仕様部の説明
    * 基本的に 4 つのユースケースを想定している
    * 1機器一覧の取得: 配列形式でデバイス一覧を受け取る
    * 2クラウドでキャッシュした危機状態の一覧取得: 直前のキャッシュ値を返す
    * 3機器の監視制御:
    * 4機器からの状態通知: EL では Inf にあたるもの
* 最近は応用ユースケースも定義している
    * 複数命令の一括指示。bulks として同期・非同期で複数命令を処理
    * 機器のグルーピング。纏めてグループ化して処理することが出来る。
    * 履歴データの蓄積・探索: 時系列データとして保存・扱う
    * 既存機器の組み合わせによる仮想機器を定義可能: PV+バッテリーなど
* 対応機器
    * EL では 100 種類以上の機器を定義しているが、LEWA では 30+ の機器を定義している
    * 市場に出ている機器については基本的に半年毎のバージョンアップで追加し続けている
* 実験クラウド環境
* 神奈川工科大学との共同研究にて、会員企業限定だが会員一人一人に対して環境を提供している
* 機器のエミュレータ機器が用意されており、実機器を繋がずとも Playground で試せる
* 初心者向けに機器を可視化してユースケースを理解しやすくしている
* 動的に獲得したデータから、機器操作をすることも出来るなど、簡単操作するための機能まである
* 纏め: 多数製品、リアルタイム制御、統一 API、ツールの充実などの特徴がある
* 今後の検討事項
* 外部連携により要件を取り込み、連携先を拡大、要件の取り込み、高度化を進める
* 皆さん是非参加してインプットしてください。宜しくお願いします。
* ガイドラインなどの仕様書リリース状況まとめ
* ツール類は仕様がアップデートされると間もなくアップデートされる形
* MRA (Machine Readable Appendix) データ
    * 仕様書を見ながら園児なが実装する、工数がかかりミスもし易い
    * MAR データ即ち機械可読な仕様書を使うことで、機械的に実装していける
    * 仕様書の Appendix は表で説明しているが JSON 形式に変換したものもある
* 一旦データ化すると、MRA データから自動で Device Description を作成
* 更にビューアなども含めて共同研究で開発、公開している
* 設計指針
    * もともと MOU　定型もしていたが、W3C WoT 標準化と EL 両方に参加するメンバーがいた
    * そんな経緯で W3C WoT モデルを参考にして定義した
    * 但し ELWA ではクラウド上の実装が主目的であるため HTTPS のみ採用するなどの簡素化をしている
* TD/DD の違い
    * 記述方法は多少異なるがエッセンスとしては同じ。用語の違いとか
        * 同じ事を違う語句で表してるのは WoT の昔の仕様の名残が ELWA にある形
    * 基本的には容易にマッピングが出来るような関係の仕様となっている
* W3C WoT 連携
    * Plugfest にて EL デバイスと ELWA Web Server に WoT 自動変換追加して相互運用を確認
    * 外出・帰宅時の機器自動制御等をユースケースとして提案している
* 相互変換は比較的容易に出来る。但し少し違いがある
    * API エンドポイントに対して返ってくる応答の形式の違い
    * WoT では値だけ、ELWA では nested json (違うかも知れない)
    * 同様に PUT の場合でも値だけ送るか json 形式で key/value セットで送るかの違い
    * ELWA の都合として PUT しても PUT 後に GET した値が返ってくる
        * 場合によっては前の値が返ってきてしまうこともあるので実機遅延を考慮して実装が必要
* 課題と今後への期待
    * これまで WoT では個別機器を制御できた
    * ELWA では応用 API として複数命令セットの一括実行や集約・加工データ処理なども出来る
    * 定期実行なども Cron job てきな事ができないかなど検討中
    * 外部データもそのまま渡すのではなく、アプリ毎ではなく汎用的な枠組みで集約する仕組みを考えている
    * WoT 側でも要件に入れて頂けるようであれば一緒に検討していきたい
* まとめてクローズ。

-----
* 質疑応答
* Q. MRAという独自？フォーマットを作った経緯など聞いてみたいと思いました。
    * 仕様をみて JSON にするのが大変だった
    * 機械可読にして変換するものを作ってみたいという KAIT からの研究の提案があった
    * 仕様を素直にマッピングしたものになっている
    * 現行世の中にあるものでそのまま使えるものがなかったため、変換した
    * OpenAPI への変換などは別途、MRA データを起点として行う形になっている
    * そもそも Web API レベルでの仕様ではなく、仕様書のデータを機械可読なモノに変換するレベルの話

-----
6. ディスカッション（モデレータ：安次富, パネリスト：水嶌, 芦村, 東村, 浅井, 寺本）
* Q. (安次富) W3C WoTにおけるクラウド集約型の利用形態のサポートについて、WoTのメンバーに質問をしたい
    * （芦村）Plugfest で実際の機器を持ち寄って接続試験をしている
    * その結果を踏まえて Profile という仕様をもう一つ作っている
    * TD の他に、今日は説明を省略したが WoT と他の規格を繋ぐガイドラインを書いている
    * ELWA とどうやって繋いでいくのかを今後説明・記述していくことになるだろう
    * (東村) WOT は Primitive な所からスタートしている仕様であり、コンチャーターではないかも知れないが今後、内部でやるのかベストプラクティスを纏めるのか、何らかの形で適用範囲を広げていくことが想定される
* Q. (安次富) デバイスをクラウドに繋ぐときに認証などはどう考えているのか。ELWA のような形を考える上で標準化などがされていたりするのか
    *  (寺本) クラウドから外については API 仕様部の事例として OAuth でのやり方を記述したりしている (記述が古いのは更新していくつもり)。実験クラウドでは API キーを発行してアカウント一人一人を認証。今後色々な形があり得るというので決めずに進めている。
    *  宅内の API については ELWA としては対象外となっている。そこは既存のベンダーが色々と作っているので、そこに対して新しい変更を強要する仕様を作る形にはしていない。この部分は色々な提案を頂きたい所。
*  WoT側のセキュリティ規定は？
    * (東村) WoT 側の Security に書けるモノは広く取っている。そこを拡張することで任意のセキュリティを取り入れられる。OAuth もベーシック認証も各種揃えている。
    * (安次富) 柔軟性を確保してる？
    * (東村)WoT 自体がセキュリティ方式を規定するのではなく、あらゆる方式を記述出来るようにしているアプローチ
* (安次富) URL いっぱいはってもらったが？
    https://w3c.github.io/wot-security/
    https://w3c.github.io/wot-discovery/
    https://w3c.github.io/wot-scripting-api/
    * (芦村) これらの仕様の関係が...
    * ELWA 側で認証が済んでるなら、それを Profile として議論していく事になる
    * 他にも DID を使って Self Sovereign でいろいろなモノと使えるものも議論されている
    * コロナパスポートなどでも使われている認証方式があるが、それらも考えている

#### 参加者からの質疑応答
* Q. スマートホーム共通規格「Matter」というものがある目にしたことがあるのですが、なにか関連性があったりするのでしょうか？
    * (寺本) 議論に上がってくることはある。Connected Home 周りで製品を出してくると話題はあるが
    * プレイベートな団体の中での情報は掴みきれず、様子見しよういう状況
    * 利用が広がるようであれば ELWA セッションでも話したように Matter に限らず有用なモノを収容していく
    * WoT 側がその対応に上手く使えるならそれを使うのもアリ
    * (水嶌) まだこの辺りはみられていないという段階だろう
    * WoT として既存のモノ、プロトコル・仕様は取り込めるように作っている
    * 新しいものを取り込んでいけるようにするのもコンセプトの一つ。
    * (安次富) こういうのこそ Binging Template で取り組めるようにするって事かな...
* Q.WoTセッション2での質問です。WoTでは、WoTアプリとの最終的な通信はHTTP(S)プロトコルのみでしょうか?他のプロトコル(TCP/UDP、MQTTなど)も使えるのでしょうか?
    * (浅井) MQTTやCoAP などの産業用途で使われている他のプロトコルも入っている。Profile や Scripting など一部のパートでは HTTP だけサンプルで書かれてるパートもあるが、随時使われるものは追加されていっている。これまでの説明でもいわれていたとおり、特定プロトコルに縛られないというのが WoT の特徴である。
* Q.１）Echonet  Consortium参加各社のWeb API採用、公開の状況はいかがでしょうか？
    * (寺本)何社かは公開で Web API を公開していただいている状況。今後も増えていくと思われる。
    * 本日、エコーネットコンソーシアムで発表も直前にあった
* (安次富)機器の例としては何があるか
    * (寺本)生活家電系のものとなる、本日紹介した VP も例となる
* Q.２）WoTにおけるProtocol bindingへのEchonet Lite Web APIのマッピングの可能性はないでしょうか？
    * (寺本) 可能性はあると思っている
* (安次富) 残り少ないが両者の関係とか
    * (芦村) アドバイスとしては、今日でたような質問は isseue に残して見やすくしたり議論を続けたりしていくと話が広がって位良いのではないか
* コメント：セキスイハイムによるNEC製HEMSサービスが、今年4月から終了することになり、宅内のechonetlite対応のエアコン機器制御サービスを取りやめると言われております。問い合わせたところ、「NECのセキュリティ技術を開示してもらえないため、セキスイハイムとしてはサービスを続行できなくなった」と説明があり、ベンダー独自の仕様に依存しがちなのかと思いました。そういった課題はやはりあるのですね。
    * (寺本)両社の視点で良くわかる問題である、オープンに開示できないことがつらい問題であったと思う
    * ベンダーも(認証の開示など)そのあたりが使いやすい状況であれば採用しやすくなるかもしれない、業界としても取り込んでいかなければならない
* (安次富) 元々 ELWA はそもそもWoT を元にしていることも合って、両社の統合も考えられなくもないのではないかと一見思うが、その辺りの可能性は？
    * (寺本) 製品も出始めてる中でどうやるかは考えどころであるが、もともと W3C 側にも参加したことで変換しやすいだろう。Proxy なりツールなりの変換する仕組みを提供して相互利用する、そういうアダプテーションをするのがあり得るだろう。
    * 規格の将来としては新しい仕様・モデルを考えるのも良いし、WoT の中に ELWA のエッセンスを取り入れていくなど、細かな点も含めて相談しながら両者で上手く統一できるのではないか。
    * (安次富) binding template の活用が王道なのかも知れない？
    * (水嶌) binding template で取り込んでいくのが一番簡単なソリューションかなと思う
    * どっちがその binding template を作るんですかという話もあるが
    * 結局それを両者にらみ合いで止まってるところがあったりするのが良くあるケース
    * 一緒にコラボというか参加して貰って作っていくというのが簡単なところではないか
    * ただ、海外だとだいたい夜中にしている、議論も英語で意思疎通が難しい所もあるかも知れない
    * CG をクッションに使って頂くのも一つの方法
    * (芦村) その辺踏まえて、EL とはリエゾンを組んでいる。その中で UC や Plugfest も参加して貰ってる
    * 結果は Profile や Binding template にオープンにやっていくことになる
    * 何処でも使える明るい未来に向けて協働していきたたい
* (安次富)ELWA の活動を WoT側への取り込みについての動きはあるのか
    * (東村)今片づけなければならない問題を優先させていかなければならないが、将来的には可能性があると思っている
    * (水嶌)将来的にはリクワイメントが出てきて、取り込みが行われていくことがあるのではないかと思っている

-----
7. 閉会（東村）
* 今回の勉強会で相互の理解が深められたことが良かったと思う
* これで全てが分かったという事はないと思うので、Github など質問を随時受け付けていきます。
